<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Start Onboarding | Aswin on Finance</title>
    <meta name="description" content="Begin your mutual fund investment journey as an NRI or OCI.">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="onboarding.css">

    <!-- PostHog Analytics -->
    <script>
        !function (t, e) { var o, n, p, r; e.__SV || (window.posthog = e, e._i = [], e.init = function (i, s, a) { function g(t, e) { var o = e.split("."); 2 == o.length && (t = t[o[0]], e = o[1]), t[e] = function () { t.push([e].concat(Array.prototype.slice.call(arguments, 0))) } } (p = t.createElement("script")).type = "text/javascript", p.async = !0, p.src = s.api_host + "/static/array.js", (r = t.getElementsByTagName("script")[0]).parentNode.insertBefore(p, r); var u = e; for (void 0 !== a ? u = e[a] = [] : a = "posthog", u.people = u.people || [], u.toString = function (t) { var e = "posthog"; return "posthog" !== a && (e += "." + a), t || (e += " (stub)"), e }, u.people.toString = function () { return u.toString(1) + ".people (stub)" }, o = "capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys getNextSurveyStep onSessionId".split(" "), n = 0; n < o.length; n++)g(u, o[n]); e._i.push([i, s, a]) }, e.__SV = 1) }(document, window.posthog || []);
        posthog.init('phc_7EZHmBCGTKA2i60owBepTfAPT2IhaHhlXTMFXlNcnCY', {
            api_host: 'https://us.i.posthog.com',
            loaded: function (posthog) {
                posthog.register({
                    'environment': (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') ? 'local' : 'production'
                });
            }
        })
    </script>
</head>

<body>
    <header class="site-header">
        <a href="index.html" class="back-link">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7" />
            </svg>
            Back
        </a>
        <div class="progress-indicator">
            <div class="progress-step active">1</div>
            <div class="progress-line"></div>
            <div class="progress-step">2</div>
            <div class="progress-line"></div>
            <div class="progress-step">3</div>
            <div class="progress-line"></div>
            <div class="progress-step">4</div>
        </div>
    </header>

    <main class="onboarding-container">
        <!-- Step 1: Choose Status -->
        <section class="onboarding-step" id="step-1">
            <div class="step-content">
                <span class="step-label">Step 1 of 3</span>
                <h1 class="step-title">What's your residency status?</h1>
                <p class="step-description">This helps us understand which documents and investment routes apply to you.
                </p>

                <div class="status-options">
                    <button class="status-card" data-status="nri" onclick="selectStatus('nri')">
                        <div class="status-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1.5">
                                <circle cx="12" cy="12" r="10" />
                                <path
                                    d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z" />
                            </svg>
                        </div>
                        <h3>NRI</h3>
                        <p>Non-Resident Indian with Indian passport</p>
                    </button>

                    <button class="status-card" data-status="oci" onclick="selectStatus('oci')">
                        <div class="status-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1.5">
                                <rect x="3" y="4" width="18" height="16" rx="2" />
                                <path d="M3 10h18" />
                                <circle cx="8" cy="15" r="2" />
                            </svg>
                        </div>
                        <h3>OCI</h3>
                        <p>Overseas Citizen of India cardholder</p>
                    </button>
                </div>
            </div>
        </section>

        <!-- Step 2: Document Checklist (NRI) -->
        <section class="onboarding-step hidden" id="step-2-nri">
            <div class="step-content">
                <span class="step-label">Step 2 of 3</span>
                <h1 class="step-title">Documents you'll need</h1>
                <p class="step-description">Here's what's typically required to open a mutual fund account as an NRI.
                    Don't worry if you don't have everything ready ‚Äî we'll guide you.</p>

                <div class="documents-list">
                    <div class="document-item">
                        <div class="document-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1.5">
                                <rect x="3" y="4" width="18" height="16" rx="2" />
                                <path d="M7 8h10M7 12h6" />
                            </svg>
                        </div>
                        <div class="document-info">
                            <h4>PAN Card</h4>
                            <p>Your Indian Permanent Account Number ‚Äî essential for all investments in India. If you
                                don't have one, we can help you apply.</p>
                        </div>
                    </div>

                    <div class="document-item">
                        <div class="document-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1.5">
                                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z" />
                                <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8" />
                            </svg>
                        </div>
                        <div class="document-info">
                            <h4>Last 2 months bank statement</h4>
                            <p>From your NRE or NRO account. This confirms your account details and recent transaction
                                history for KYC purposes.</p>
                        </div>
                    </div>

                    <div class="document-item">
                        <div class="document-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1.5">
                                <rect x="3" y="4" width="18" height="16" rx="2" />
                                <circle cx="12" cy="11" r="3" />
                                <path d="M7 17h10" />
                            </svg>
                        </div>
                        <div class="document-info">
                            <h4>Indian passport</h4>
                            <p>Valid or expired Indian passport to establish your citizenship. The passport number is
                                used for identity verification.</p>
                        </div>
                    </div>

                    <div class="document-item">
                        <div class="document-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1.5">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z" />
                                <circle cx="12" cy="10" r="3" />
                            </svg>
                        </div>
                        <div class="document-info">
                            <h4>Overseas address proof</h4>
                            <p>Utility bill, bank statement, or lease agreement from your country of residence ‚Äî to
                                confirm your current overseas address.</p>
                        </div>
                    </div>

                    <div class="document-item">
                        <div class="document-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1.5">
                                <rect x="3" y="4" width="18" height="16" rx="2" />
                                <path d="M3 10h18" />
                                <path d="M8 14h2M8 17h4" />
                            </svg>
                        </div>
                        <div class="document-info">
                            <h4>National ID from country of residence</h4>
                            <p>Driver's license, national ID card, or equivalent government-issued ID from where you
                                currently live.</p>
                        </div>
                    </div>
                </div>

                <div class="acknowledgement-section">
                    <label class="acknowledgement-checkbox">
                        <input type="checkbox" id="docs-acknowledgement" onchange="toggleContinue()">
                        <span class="checkmark"></span>
                        <span class="acknowledgement-text">I have all the documents listed above, or I'm ready to
                            proceed and will gather any missing ones.</span>
                    </label>
                </div>

                <div class="step-actions">
                    <button class="btn-secondary" onclick="goBack()">Back</button>
                    <button class="btn-primary" id="continue-btn" disabled onclick="goToStep3()">Continue</button>
                </div>
            </div>
        </section>

        <!-- Step 2: OCI (Coming Soon) -->
        <section class="onboarding-step hidden" id="step-2-oci">
            <div class="step-content">
                <span class="step-label">Step 2 of 3</span>
                <h1 class="step-title">OCI onboarding coming soon</h1>
                <p class="step-description">We're still building the OCI-specific flow. For now, please reach out to us
                    directly and we'll guide you through the process.</p>

                <div class="coming-soon-card">
                    <p>In the meantime, you can email us at <strong>hello@aswinonfinance.com</strong> with your details
                        and we'll get back to you within 24 hours.</p>
                </div>

                <div class="step-actions">
                    <button class="btn-secondary" onclick="goBack()">Back</button>
                </div>
            </div>
        </section>

        <!-- Step 3: Share Your Details -->
        <section class="onboarding-step hidden" id="step-3">
            <div class="step-content">
                <span class="step-label">Step 3 of 4</span>
                <h1 class="step-title">Share a few details</h1>
                <p class="step-description">Help us understand your investment goals. This takes just a couple of
                    minutes.</p>

                <div class="details-form">
                    <!-- Monthly Investment -->
                    <div class="form-group">
                        <label class="form-label">
                            <span class="label-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="1.5">
                                    <path d="M12 1v22M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6" />
                                </svg>
                            </span>
                            Monthly investment amount
                        </label>
                        <div class="amount-selector">
                            <button class="amount-option" onclick="selectAmount(5000)">‚Çπ5,000</button>
                            <button class="amount-option" onclick="selectAmount(10000)">‚Çπ10,000</button>
                            <button class="amount-option selected" onclick="selectAmount(25000)">‚Çπ25,000</button>
                            <button class="amount-option" onclick="selectAmount(50000)">‚Çπ50,000</button>
                            <button class="amount-option" onclick="selectAmount(100000)">‚Çπ1,00,000+</button>
                        </div>
                    </div>

                    <!-- Financial Goal -->
                    <div class="form-group">
                        <label class="form-label">
                            <span class="label-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="1.5">
                                    <circle cx="12" cy="12" r="10" />
                                    <circle cx="12" cy="12" r="6" />
                                    <circle cx="12" cy="12" r="2" />
                                </svg>
                            </span>
                            What's your goal?
                        </label>
                        <div class="goal-options">
                            <button class="goal-option" onclick="selectGoal(this)">
                                <span class="goal-emoji">üè†</span>
                                <span>Property in India</span>
                            </button>
                            <button class="goal-option" onclick="selectGoal(this)">
                                <span class="goal-emoji">üë®‚Äçüë©‚Äçüëß</span>
                                <span>Children's future</span>
                            </button>
                            <button class="goal-option" onclick="selectGoal(this)">
                                <span class="goal-emoji">üèñÔ∏è</span>
                                <span>Retirement</span>
                            </button>
                            <button class="goal-option" onclick="selectGoal(this)">
                                <span class="goal-emoji">üí∞</span>
                                <span>Wealth building</span>
                            </button>
                            <button class="goal-option" onclick="selectGoal(this)">
                                <span class="goal-emoji">üéØ</span>
                                <span>Specific goal</span>
                            </button>
                            <button class="goal-option" onclick="selectGoal(this)">
                                <span class="goal-emoji">ü§∑</span>
                                <span>Not sure yet</span>
                            </button>
                        </div>
                    </div>

                    <!-- Time Horizon -->
                    <div class="form-group">
                        <label class="form-label">
                            <span class="label-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="1.5">
                                    <circle cx="12" cy="12" r="10" />
                                    <path d="M12 6v6l4 2" />
                                </svg>
                            </span>
                            How long do you plan to stay invested?
                        </label>
                        <div class="horizon-options">
                            <button class="horizon-option" onclick="selectHorizon(this)">
                                <span class="horizon-years">1-3</span>
                                <span class="horizon-label">years</span>
                            </button>
                            <button class="horizon-option" onclick="selectHorizon(this)">
                                <span class="horizon-years">3-5</span>
                                <span class="horizon-label">years</span>
                            </button>
                            <button class="horizon-option selected" onclick="selectHorizon(this)">
                                <span class="horizon-years">5-10</span>
                                <span class="horizon-label">years</span>
                            </button>
                            <button class="horizon-option" onclick="selectHorizon(this)">
                                <span class="horizon-years">10+</span>
                                <span class="horizon-label">years</span>
                            </button>
                        </div>
                    </div>

                    <div class="step-actions">
                        <button class="btn-secondary" onclick="goBackToStep2()">Back</button>
                        <button class="btn-primary" id="step3-continue-btn" disabled
                            onclick="goToStep4()">Continue</button>
                    </div>
                </div>
        </section>

        <!-- Step 4: Personal Details -->
        <section class="onboarding-step hidden" id="step-4">
            <div class="step-content">
                <span class="step-label">Step 4 of 4</span>
                <h1 class="step-title">Your details</h1>
                <p class="step-description">So we can reach out with your personalized investment path.</p>

                <div class="details-form">
                    <div class="input-group">
                        <label class="input-label">Full name</label>
                        <input type="text" id="user-name" placeholder="Enter your full name" class="text-input">
                        <span id="name-error" class="input-error">Please enter at least 2 characters</span>
                    </div>

                    <div class="input-group">
                        <label class="input-label">Country of residence</label>
                        <select id="user-country" class="select-input">
                            <option value="">Select your country</option>
                            <option value="US">United States</option>
                            <option value="UK">United Kingdom</option>
                            <option value="UAE">United Arab Emirates</option>
                            <option value="SG">Singapore</option>
                            <option value="AU">Australia</option>
                            <option value="CA">Canada</option>
                            <option value="DE">Germany</option>
                            <option value="NL">Netherlands</option>
                            <option value="HK">Hong Kong</option>
                            <option value="MY">Malaysia</option>
                            <option value="SA">Saudi Arabia</option>
                            <option value="QA">Qatar</option>
                            <option value="KW">Kuwait</option>
                            <option value="BH">Bahrain</option>
                            <option value="OM">Oman</option>
                            <option value="NZ">New Zealand</option>
                            <option value="IN">India</option>
                            <option value="OTHER">Other</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label class="override-checkbox">
                            <input type="checkbox" id="indian-number-override">
                            <span class="checkbox-box"></span>
                            <span class="checkbox-text">I'm using an Indian number</span>
                        </label>
                    </div>

                    <!-- WhatsApp Number Section -->
                    <div class="input-group">
                        <label class="input-label">Your WhatsApp number</label>
                        <div class="phone-input-wrapper">
                            <span id="country-code-prefix" class="country-code-prefix">+</span>
                            <input type="tel" id="phone-number" placeholder="Select country first"
                                class="text-input phone-with-prefix" disabled>
                        </div>
                        <span id="phone-error" class="input-error">Please enter a valid phone number</span>
                    </div>

                </div>

                <div class="step-actions">
                    <button class="btn-secondary" onclick="goBackToStep3()">Back</button>
                    <button class="btn-primary" id="final-submit-btn" disabled onclick="submitDetails()">Book a call
                        with Aswin</button>
                </div>
            </div>
        </section>

        <!-- Step 5: Confirmation -->
        <section class="onboarding-step hidden" id="step-5">
            <div class="step-content confirmation-content">
                <div class="confirmation-icon">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="1.5">
                        <circle cx="12" cy="12" r="10" />
                        <path d="M9 12l2 2 4-4" />
                    </svg>
                </div>
                <h1 class="step-title">You're all set!</h1>
                <p class="step-description">We've received your details. Our team will reach out within 24 hours with a
                    personalized investment path based on your goals and NRI status.</p>

                <div class="next-steps-card">
                    <h4>What happens next?</h4>
                    <ul>
                        <li>We'll review your information and prepare recommendations</li>
                        <li>You'll receive a personalized guide on WhatsApp</li>
                        <li>We'll schedule a call if you have questions</li>
                    </ul>
                </div>

                <div class="step-actions centered">
                    <a href="index.html" class="btn-primary">Back to Home</a>
                </div>
            </div>
        </section>
    </main>

    <script type="module">
        import { supabase } from '../js/supabase-client.js';

        // Make functions globally available since we're inside a module
        window.selectStatus = selectStatus;
        window.toggleContinue = toggleContinue;
        window.goBack = goBack;
        window.goToStep3 = goToStep3;
        window.goBackToStep2 = goBackToStep2;
        window.goToStep4 = goToStep4;
        window.goBackToStep3 = goBackToStep3;
        window.selectAmount = selectAmount;
        window.selectGoal = selectGoal;
        window.selectHorizon = selectHorizon;
        window.submitDetails = submitDetails;

        let currentStep = 1;
        let selectedStatus = null;
        let formData = {
            amount: 25000,
            goal: null,
            horizon: '5-10',
            contact: 'whatsapp',
            phone: ''
        };

        function selectStatus(status) {
            selectedStatus = status;
            formData.residency = status === 'nri' ? 'NRI' : 'OCI'; // Add residency to formData

            // Update visual selection
            document.querySelectorAll('.status-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`[data-status="${status}"]`).classList.add('selected');

            // Show appropriate step 2 after a brief delay
            setTimeout(() => {
                document.getElementById('step-1').classList.add('hidden');
                if (status === 'nri') {
                    document.getElementById('step-2-nri').classList.remove('hidden');
                } else {
                    document.getElementById('step-2-oci').classList.remove('hidden');
                }
                updateProgress(2);
            }, 300);
        }

        function toggleContinue() {
            const checkbox = document.getElementById('docs-acknowledgement');
            const continueBtn = document.getElementById('continue-btn');
            continueBtn.disabled = !checkbox.checked;
        }

        function goBack() {
            document.getElementById('step-2-nri').classList.add('hidden');
            document.getElementById('step-2-oci').classList.add('hidden');
            document.getElementById('step-1').classList.remove('hidden');
            updateProgress(1);
        }

        function goToStep3() {
            document.getElementById('step-2-nri').classList.add('hidden');
            document.getElementById('step-3').classList.remove('hidden');
            updateProgress(3);
            window.scrollTo(0, 0);
        }

        function goBackToStep2() {
            document.getElementById('step-3').classList.add('hidden');
            document.getElementById('step-2-nri').classList.remove('hidden');
            updateProgress(2);
        }

        function goToStep4() {
            document.getElementById('step-3').classList.add('hidden');
            document.getElementById('step-4').classList.remove('hidden');
            updateProgress(4);
            window.scrollTo(0, 0);
        }

        function goBackToStep3() {
            document.getElementById('step-4').classList.add('hidden');
            document.getElementById('step-3').classList.remove('hidden');
            updateProgress(3);
        }

        function selectAmount(amount) {
            formData.amount = amount;
            document.querySelectorAll('.amount-option').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
            validateStep3();
        }

        function selectGoal(element) {
            document.querySelectorAll('.goal-option').forEach(btn => btn.classList.remove('selected'));
            element.classList.add('selected');
            formData.goal = element.querySelector('span:last-child').textContent;
            validateStep3();
        }

        function selectHorizon(element) {
            document.querySelectorAll('.horizon-option').forEach(btn => btn.classList.remove('selected'));
            element.classList.add('selected');
            formData.horizon = element.querySelector('.horizon-years').textContent;
            validateStep3();
        }

        function validateStep3() {
            const continueBtn = document.getElementById('step3-continue-btn');
            // All fields are mandatory: amount, goal, and horizon
            if (formData.amount && formData.goal && formData.horizon) {
                continueBtn.disabled = false;
            } else {
                continueBtn.disabled = true;
            }
        }

        // Country code mapping
        const countryCodes = {
            'US': '+1',
            'UK': '+44',
            'UAE': '+971',
            'SG': '+65',
            'AU': '+61',
            'CA': '+1',
            'DE': '+49',
            'NL': '+31',
            'HK': '+852',
            'MY': '+60',
            'SA': '+966',
            'QA': '+974',
            'KW': '+965',
            'BH': '+973',
            'OM': '+968',
            'NZ': '+64',
            'IN': '+91',
            'OTHER': '+'
        };

        // Handle country selection and Indian number override
        const countrySelect = document.getElementById('user-country');
        const indianNumberOverride = document.getElementById('indian-number-override');
        const phoneInput = document.getElementById('phone-number');
        const countryCodePrefix = document.getElementById('country-code-prefix');

        function updatePhonePrefix() {
            const country = countrySelect.value;
            const isIndianOverride = indianNumberOverride.checked;

            if (isIndianOverride) {
                countryCodePrefix.textContent = '+91';
                phoneInput.disabled = false;
                phoneInput.placeholder = 'Enter your number';
            } else if (country && countryCodes[country]) {
                countryCodePrefix.textContent = countryCodes[country];
                phoneInput.disabled = false;
                phoneInput.placeholder = 'Enter your number';
            } else {
                countryCodePrefix.textContent = '+';
                phoneInput.disabled = true;
                phoneInput.placeholder = 'Select country first';
                phoneInput.value = '';
            }
            validateStep4();
        }

        countrySelect.addEventListener('change', updatePhonePrefix);
        indianNumberOverride.addEventListener('change', updatePhonePrefix);

        // Add event listeners for Step 4 validation
        document.getElementById('user-name').addEventListener('input', validateStep4);
        document.getElementById('user-name').addEventListener('blur', () => validateField('name'));
        document.getElementById('phone-number').addEventListener('input', validateStep4);
        document.getElementById('phone-number').addEventListener('blur', () => validateField('phone'));

        // Validation patterns
        const patterns = {
            name: /^.{2,}$/,  // At least 2 characters
            phone: /^[0-9]{6,14}$/  // 6-14 digits (country code is separate)
        };

        function validateField(field) {
            const nameInput = document.getElementById('user-name');
            const phoneInput = document.getElementById('phone-number');

            if (field === 'name') {
                const name = nameInput.value.trim();
                const isValid = patterns.name.test(name);
                nameInput.classList.toggle('error', name && !isValid);
                document.getElementById('name-error').classList.toggle('visible', name && !isValid);
            } else if (field === 'phone') {
                const phone = phoneInput.value.trim();
                const isValid = patterns.phone.test(phone);
                phoneInput.classList.toggle('error', phone && !isValid);
                document.getElementById('phone-error').classList.toggle('visible', phone && !isValid);
            }
        }

        function validateStep4() {
            const name = document.getElementById('user-name').value.trim();
            const country = document.getElementById('user-country').value;
            const phone = document.getElementById('phone-number').value.trim();

            const nameValid = patterns.name.test(name);
            const phoneValid = patterns.phone.test(phone);

            const isValid = nameValid && country && phoneValid;

            document.getElementById('final-submit-btn').disabled = !isValid;
        }


        async function submitDetails() {
            const submitBtn = document.getElementById('final-submit-btn');
            submitBtn.textContent = 'Submitting...';
            submitBtn.disabled = true;

            formData.name = document.getElementById('user-name').value;
            formData.country = document.getElementById('user-country').value;
            formData.contact = 'whatsapp';

            // Construct full phone with country code
            const countryCode = document.getElementById('country-code-prefix').textContent;
            const phoneNumber = document.getElementById('phone-number').value;
            formData.phone = countryCode + phoneNumber;
            formData.email = null;

            // Prepare payload matching Supabase table structure
            const payload = {
                name: formData.name,
                country: formData.country,
                status: formData.residency || 'NRI', // Default to NRI if not set
                amount: formData.amount,
                goal: formData.goal,
                horizon: formData.horizon,
                contact_method: formData.contact,
                phone: formData.phone,
                email: formData.email,
                submitted_at: new Date().toISOString()
            };


            console.log('Submitting to Supabase:', payload);

            try {
                const { data, error } = await supabase
                    .from('leads')
                    .insert([payload]);

                if (error) throw error;

                console.log('Success:', data);

                document.getElementById('step-4').classList.add('hidden');
                document.getElementById('step-5').classList.remove('hidden');
                window.scrollTo(0, 0);

            } catch (error) {
                console.error('Error submitting lead:', error);
                alert('There was an error submitting your details. Please try again.');
                submitBtn.textContent = 'Book a call with Aswin';
                submitBtn.disabled = false;
            }
        }

        function updateProgress(step) {
            document.querySelectorAll('.progress-step').forEach((el, index) => {
                if (index < step) {
                    el.classList.add('active');
                } else {
                    el.classList.remove('active');
                }
            });
        }
    </script>
</body>

</html>